<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale = 1.0" />
<link rel="stylesheet" href="/studyphp/style.css">
<script src="/studyphp/js/jquery-3.2.1.min.js"></script>
<script>
	$(document).ready(function() {

		var dd = 0;
		var dd2 = 0;
		var hint;
		var value_old = "";

		$("input").on("focus", repeat);//focus이벤트시 repeat 함수 실행
		function repeat() {//repeat함수

			hint = setInterval(function() {//setInterval함수를 전역변수 hint에 저장
				var value = $("#text_input").val();//new에 저장
				$("#input").text(value);//입력된 문자 표시(테스트용)
				if (value_old !== value)//처음 value_old는 ""이다.
					showHint(value);//ajax실행
				value_old = value;//value_old는에 new를 저장함.
			}, 1000);//즉, 만약 old변수가 new변수와 다를 경우 1초에 한번씩 실행

		}
		$("input").on("blur", offshowHint);//blur시에 할것들
		function offshowHint() {
			dd++;//blur한 회수를 나타내기 위한 것(테스트용)
			$("#blur").text(dd);//테스트용
			clearInterval(hint);//전역변수 hint에 클리어 인터벌로 중지시키는 역할(중요!! 전역변수로 이걸 저장해야지 안그러면 이거 안먹힘)
		}

		function showHint(str) {
			dd2++;
			$("#ajax").text(dd2);
			if (str.length == 0) {
				document.getElementById("txtHint").innerHTML = "";
				return;
			} else {
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (this.readyState == 4
							&& this.status == 200) {
						var output = this.responseText;
						output = output.replace(/\+/g, "%20");//스페이스바를 하는것
						output = decodeURIComponent(output);
						document.getElementById("output").innerHTML = output;
						document.getElementById("txtHint").innerHTML = output;
					}
				};
				xmlhttp.open("GET", "ajax_01.php?q="
						+ encodeURIComponent(str), true);
				xmlhttp.send();
			}
		}
	});
</script>
<title>Ajax</title>
</head>
<body>

	<p>
		<b>이름을 입력해 보세요.</b>
	</p>
	<form>
		First name: <input id="text_input" type="text">
	</form>
	<p>
		Suggestions : <span id="txtHint"></span>
	</p>
	<table></table>
	<table>
		<tr>
			<th>항목</th>
			<th>수</th>
		</tr>
		<tr>
			<td>blur 횟수:</td>
			<td id="blur">칸에 포커스를 해제 할 때 마다 1씩 늘어난다.
		</tr>

		<tr>
			<td>ajax 횟수:</td>
			<td id="ajax">칸에 입력되면 1초마다 반복될 것이고, blur하면 중지 된다.</td>
		</tr>
		<tr>
			<td>입력된 문자:</td>
			<td id="input">위에 input 텍스트에 입력된 곳은 이곳에 나타내어진다.</td>
		</tr>
		<tr>
			<td>넘오온 글자</td>
			<td id="output">위에 input 텍스트에 입력된 곳은 이곳에 나타내어진다.</td>
		</tr>
		<!-- <tr>
			<td>value_old</td>
			<td id="value_old">임의의 테스트</td>
		</tr>
	  -->
	</table>

</body>
</html>